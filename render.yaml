services:
  # ── 1. Python game server ───────────────────────────────────────────────
  - type: web
    name: garage
    runtime: python
    region: oregon
    plan: free
    rootDir: Garage
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: JWT_SECRET_KEY
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_MODEL
        value: "gpt-4.1-mini"
      - key: OPENAI_FALLBACK_MODELS
        value: "gpt-4.1-mini,gpt-4.1,gpt-4o"
      - key: GROQ_API_KEY
        sync: false
      - key: GROQ_MODEL
        value: "llama-3.3-70b-versatile"
      - key: AI_CHAT_MAX_TOKENS
        value: "1200"
      - key: JAVA_COMPILE_TIMEOUT
        value: "15"
      - key: JAVA_RUN_TIMEOUT
        value: "10"
      - key: JAVA_RUNNER_URL
        # After deploying garage-java-runner, paste its URL here.
        # Example: https://garage-java-runner.onrender.com
        # The Python service proxies all /api/run-java calls to this URL.
        sync: false
      - key: JAVA_RUNNER_SECRET
        # Must match RUNNER_SECRET set on the garage-java-runner service.
        sync: false
      - key: ADMIN_USERNAME
        sync: false
      - key: ADMIN_EMAIL
        sync: false

  # ── 2. Java 17 code runner (Spring Boot) ───────────────────────────────
  - type: web
    name: garage-java-runner
    runtime: docker
    region: oregon
    plan: free
    rootDir: Garage/java-runner
    dockerfilePath: ./Dockerfile
    healthCheckPath: /health
    envVars:
      - key: JAVA_COMPILE_TIMEOUT
        value: "15"
      - key: JAVA_RUN_TIMEOUT
        value: "10"
      - key: RUNNER_SECRET
        # Set a strong random value here AND in JAVA_RUNNER_SECRET above.
        # Shared secret prevents unauthorized direct calls to this service.
        sync: false
